


import PID
import time
import matplotlib.pyplot as plt
import numpy as np
from scipy.interpolate import spline


# test = [
# 3.8132526559,
# 2.8983384751,
# 5.8188749918,
# 4.5469042584,
# 4.908833498,
# 3.2357135,
# 5.0586575315,
# 4.8270184974,
# 7.4251328798,
# 2.8187382834,
# 3.5276084086,
# 3.2044822601,
# 7.3372906468,
# 4.2328705433,
# 5.7010506204,
# 2.7547955211,
# 6.525896258,
# 2.8641579758,
# 3.8618002569,
# 5.5558434009,
# 3.115463876,
# 3.8773088116,
# 4.7320269281,
# 5.1544773223,
# 6.4430375903,
# 2.7696867546,
# 4.5151372261,
# 3.7340732374,
# 4.9548177947,
# 6.1994150173,
# 6.2777057436,
# 3.2104660117,
# 3.8132300565,
# 5.2657650061,
# 4.5443217579,
# 4.0412263608,
# 3.5869960316,
# 3.612031853,
# 7.3413643344,
# 4.9896883404,
# 3.5066748017,
# 5.8110185038,
# 7.3308090931,
# 6.8969135866,
# 3.1673419965,
# 3.4846738662,
# 5.6161991486,
# 5.1553787892,
# 6.6271195402,
# 6.79160717,
# 2.5593162944,
# 6.4033268957,
# 4.7726759358,
# 3.4613505475,
# 4.2634780945,
# 2.5071881947,
# 7.2130074822,
# 2.7292575402,
# 2.7926130658,
# 5.7160357187,
# 7.3125743449,
# 7.30783818,
# 5.6244659843,
# 7.3994705704,
# 3.1693687871,
# 6.3977088547,
# 3.0636038124,
# 3.3428808826,
# 7.4592531905,
# 6.4653557257,
# 3.8772937124,
# 4.6264898021,
# 7.4111522533,
# 5.4052509968,
# 4.2451527793,
# 6.6418545277,
# 2.9237952962,
# 5.9549960796,
# 6.3709409296,
# 4.1984031665,
# 3.0630620284,
# 7.1021253831,
# 2.6189791263,
# 6.2272310512,
# 6.5034851047,
# 4.6571090193,
# 3.911173361,
# 6.5746886399,
# 5.9146489914,
# 4.246854761,
# 2.5740845937,
# 5.9819667902,
# 5.7159712932,
# 6.0291709625,
# 5.7425867868,
# 3.9100308822,
# 5.8052103622,
# 6.7314481026,
# 5.4617359877,
# 5.9948369466]

# test_bkup = [
# 3.8132526559,
# 2.8983384751,
# 5.8188749918,
# 4.5469042584,
# 4.908833498,
# 3.2357135,
# 5.0586575315,
# 4.8270184974,
# 7.4251328798,
# 2.8187382834,
# 3.5276084086,
# 3.2044822601,
# 7.3372906468,
# 4.2328705433,
# 5.7010506204,
# 2.7547955211,
# 6.525896258,
# 2.8641579758,
# 3.8618002569,
# 5.5558434009,
# 3.115463876,
# 3.8773088116,
# 4.7320269281,
# 5.1544773223,
# 6.4430375903,
# 2.7696867546,
# 4.5151372261,
# 3.7340732374,
# 4.9548177947,
# 6.1994150173,
# 6.2777057436,
# 3.2104660117,
# 3.8132300565,
# 5.2657650061,
# 4.5443217579,
# 4.0412263608,
# 3.5869960316,
# 3.612031853,
# 7.3413643344,
# 4.9896883404,
# 3.5066748017,
# 5.8110185038,
# 7.3308090931,
# 6.8969135866,
# 3.1673419965,
# 3.4846738662,
# 5.6161991486,
# 5.1553787892,
# 6.6271195402,
# 6.79160717,
# 2.5593162944,
# 6.4033268957,
# 4.7726759358,
# 3.4613505475,
# 4.2634780945,
# 2.5071881947,
# 7.2130074822,
# 2.7292575402,
# 2.7926130658,
# 5.7160357187,
# 7.3125743449,
# 7.30783818,
# 5.6244659843,
# 7.3994705704,
# 3.1693687871,
# 6.3977088547,
# 3.0636038124,
# 3.3428808826,
# 7.4592531905,
# 6.4653557257,
# 3.8772937124,
# 4.6264898021,
# 7.4111522533,
# 5.4052509968,
# 4.2451527793,
# 6.6418545277,
# 2.9237952962,
# 5.9549960796,
# 6.3709409296,
# 4.1984031665,
# 3.0630620284,
# 7.1021253831,
# 2.6189791263,
# 6.2272310512,
# 6.5034851047,
# 4.6571090193,
# 3.911173361,
# 6.5746886399,
# 5.9146489914,
# 4.246854761,
# 2.5740845937,
# 5.9819667902,
# 5.7159712932,
# 6.0291709625,
# 5.7425867868,
# 3.9100308822,
# 5.8052103622,
# 6.7314481026,
# 5.4617359877,
# 5.9948369466]

P = 1  
I = 0.5
D= 1.5
# L=100

pid = PID.PID(P, I, D)

#Tensao desejada
pid.SetPoint=4.0
pid.setSampleTime(0.01)

END = 100

#Tensao na carga
feedback = test

feedback_list = []
time_list = []
setpoint_list = []
output_list = []

for i in range(1, END):
    pid.update(feedback[i])
    output = pid.output

    # if output < 0:
     	# output = 0

    if pid.SetPoint > 0:
    	feedback[i] += (output - (1/i))
    # if i>9:
    #     pid.SetPoint = 1
    time.sleep(0.02)

    feedback_list.append(feedback[i])
    setpoint_list.append(pid.SetPoint)
    output_list.append(pid.output)
    time_list.append(i)

time_sm = np.array(time_list)
time_smooth = np.linspace(time_sm.min(), time_sm.max(), 300)
feedback_smooth = spline(time_list, feedback_list, time_smooth)
output_smooth = spline(time_list, output_list, time_smooth)


plt.plot(time_smooth, output_smooth, label = 'output')
plt.plot(time_smooth, feedback_smooth, label = 'feedback')
plt.plot(time_list, setpoint_list, label = 'setpoint')
plt.plot(test_bkup,label = 'test')
plt.xlim((0, L))
#plt.ylim((min(feedback_list)-0.5, max(feedback_list)+0.5))
plt.xlabel('time (s)')
plt.ylabel('PID (PV)')
plt.title('TEST PID')
plt.legend()

#plt.ylim((1-0.5, 1+0.5))

plt.grid(True)
plt.show()
